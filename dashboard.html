<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Company Control Panel</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      display: flex;
      margin: 0;
      font-family: Arial;
      background: #f4f6f9;
    }

    .sidebar {
      width: 220px;
      background: #2c3e50;
      color: white;
      height: 100vh;
      padding: 20px;
    }

    .sidebar h3 {
      margin-top: 0;
    }

    .sidebar button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      background: #34495e;
      border: none;
      color: white;
      cursor: pointer;
    }

    .main {
      flex: 1;
      padding: 30px;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      text-align: center;
    }
  </style>
</head>

<body>

<div class="sidebar">
  <h3>Company Panel</h3>
  <div id="projectLinks"></div>
  <button onclick="logout()">Logout</button>
</div>

<div class="main">
  <h2 id="welcomeText"></h2>
  <div id="dashboardSection"></div>
</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbyl1P_4MqzZCKcEHzIvE1edB94lLcctBI9XHoCOgscKPXtF2l7_T8HIkP_y0qPoPsYl/exec";

const PROJECT_LINKS = {
  expenses: "https://mokh008.github.io/Expenses-System/",
  rentals: "https://mokh008.github.io/Rent-Payment-UI/",
  attendance: "https://mokh008.github.io/Attendance-Login/"
};

const user = JSON.parse(localStorage.getItem("user"));

if (!user) {
  window.location.href = "index.html";
}

document.getElementById("welcomeText").innerText =
  `Welcome ${user.name} (${user.role})`;

// ===== PROJECT BUTTONS =====
const projectDiv = document.getElementById("projectLinks");

function addButton(title, link) {
  const btn = document.createElement("button");
  btn.innerText = title;
  btn.onclick = () => window.open(link, "_blank");
  projectDiv.appendChild(btn);
}

// Engineer
if (user.role === "engineer") {
  addButton("Expenses", PROJECT_LINKS.expenses);
  addButton("Rentals", PROJECT_LINKS.rentals);

  if (user.employee_id == 1001194) {
    addButton("Attendance", PROJECT_LINKS.attendance);
  }
}

// Manager & Admin
if (user.role === "admin" || user.role === "manager") {
  addButton("Expenses", PROJECT_LINKS.expenses);
  addButton("Rentals", PROJECT_LINKS.rentals);
  addButton("Attendance", PROJECT_LINKS.attendance);
}

// ===== DASHBOARD DATA =====
if (user.role === "admin" || user.role === "manager") {

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "dashboard",
      user: user
    })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("dashboardSection").innerHTML = `
      <div class="cards">
        <div class="card">
          <h4>Monthly Expenses</h4>
          <p>${data.expenses.monthlyTotal}</p>
        </div>
        <div class="card">
          <h4>Total Expenses</h4>
          <p>${data.expenses.total}</p>
        </div>
        <div class="card">
          <h4>Monthly Rent</h4>
          <p>${data.rent.monthlyTotal}</p>
        </div>
        <div class="card">
          <h4>Total Rent</h4>
          <p>${data.rent.total}</p>
        </div>
        <div class="card">
          <h4>Active Employees</h4>
          <p>${data.activeEmployees}</p>
        </div>
      </div>
    `;
  });
}

function logout() {
  localStorage.removeItem("user");
  window.location.href = "index.html";
}

</script>

</body>
</html>
