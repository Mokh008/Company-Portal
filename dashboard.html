<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>MK Nexus</title>

<style>
:root{
  --bg: #0b0f19;
  --card: #121826;
  --accent: #2dd4bf;
  --text: #f1f5f9;
  --muted: #94a3b8;
  --border: #1f2937;
}

body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(180deg,#0b0f19 0%, #0e1422 100%);
  color: var(--text);
}

/* Watermark */
.watermark{
  position:fixed;
  right:-200px;
  bottom:-200px;
  width:900px;
  opacity:0.025;
  pointer-events:none;
}

/* Container */
.container{
  padding:50px 60px;
}

/* Header */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:60px;
}

.brand{
  display:flex;
  align-items:center;
  gap:15px;
}

.brand img{
  height:45px;
}

.brand h1{
  margin:0;
  font-size:26px;
  font-weight:600;
  letter-spacing:2px;
}

.user-info{
  color:var(--muted);
  font-size:14px;
}

.logout{
  cursor:pointer;
  color:var(--accent);
  font-weight:500;
  margin-top:5px;
}

.logout:hover{
  opacity:0.8;
}

/* Projects */
.projects{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(280px,1fr));
  gap:30px;
  margin-bottom:60px;
}

.project-card{
  background:var(--card);
  border-radius:20px;
  padding:40px;
  text-align:center;
  cursor:pointer;
  transition:0.4s ease;
  border:1px solid var(--border);
}

.project-card:hover{
  transform:translateY(-8px);
  border:1px solid var(--accent);
  box-shadow:0 20px 50px rgba(0,0,0,0.6);
}

.project-card img{
  width:90px;
  margin-bottom:20px;
}

.project-card h3{
  margin:0;
  font-weight:500;
  font-size:18px;
}

/* Stats */
.stats{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(250px,1fr));
  gap:30px;
}

.stat-card{
  background:var(--card);
  padding:35px;
  border-radius:20px;
  border:1px solid var(--border);
  transition:0.3s;
}

.stat-card:hover{
  border:1px solid var(--accent);
  box-shadow:0 15px 40px rgba(0,0,0,0.5);
}

.stat-card h4{
  margin:0;
  font-weight:400;
  color:var(--muted);
  font-size:13px;
  letter-spacing:1px;
}

.value{
  margin-top:15px;
  font-size:30px;
  font-weight:600;
  color:var(--accent);
}
</style>
</head>

<body>

<img src="assets/icons/mk-nexus.png" class="watermark">

<div class="container">

  <div class="header">
    <div class="brand">
      <img src="assets/icons/mk-nexus.png">
      <h1>MK Nexus</h1>
    </div>

    <div>
      <div class="user-info" id="userInfo"></div>
      <div class="logout" onclick="logout()">Logout</div>
    </div>
  </div>

  <div id="projectsSection" class="projects"></div>

  <div id="statsSection"></div>

</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbyl1P_4MqzZCKcEHzIvE1edB94lLcctBI9XHoCOgscKPXtF2l7_T8HIkP_y0qPoPsYl/exec";

const PROJECT_LINKS = {
  attendance: "PUT_ATTENDANCE_LINK",
  expenses: "PUT_EXPENSES_LINK",
  rentals: "PUT_RENT_LINK"
};

const user = JSON.parse(localStorage.getItem("user"));

if(!user){
  window.location.href="index.html";
}

document.getElementById("userInfo").innerText =
  `${user.name} â€¢ ${user.role}`;

/* ========= PROJECTS ========= */

function addProject(title, link, icon){
  const div = document.createElement("div");
  div.className="project-card";
  div.innerHTML=`
    <img src="assets/icons/${icon}">
    <h3>${title}</h3>
  `;
  div.onclick=()=>window.open(link,"_blank");
  document.getElementById("projectsSection").appendChild(div);
}

if(user.role==="engineer"){
  addProject("Expenses", PROJECT_LINKS.expenses, "expenses.png");
  addProject("Rentals", PROJECT_LINKS.rentals, "rental.png");

  if(user.employee_id==1001194){
    addProject("Attendance", PROJECT_LINKS.attendance, "attendance.png");
  }
}

if(user.role==="admin" || user.role==="manager"){
  addProject("Attendance", PROJECT_LINKS.attendance, "attendance.png");
  addProject("Expenses", PROJECT_LINKS.expenses, "expenses.png");
  addProject("Rentals", PROJECT_LINKS.rentals, "rental.png");

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"dashboard",
      user:user
    })
  })
  .then(res=>res.json())
  .then(data=>{
    document.getElementById("statsSection").innerHTML=`
      <div class="stats">
        <div class="stat-card">
          <h4>Monthly Expenses</h4>
          <div class="value">${data.expenses.monthlyTotal}</div>
        </div>
        <div class="stat-card">
          <h4>Total Expenses</h4>
          <div class="value">${data.expenses.total}</div>
        </div>
        <div class="stat-card">
          <h4>Monthly Rent</h4>
          <div class="value">${data.rent.monthlyTotal}</div>
        </div>
        <div class="stat-card">
          <h4>Total Rent</h4>
          <div class="value">${data.rent.total}</div>
        </div>
        <div class="stat-card">
          <h4>Active Employees</h4>
          <div class="value">${data.activeEmployees}</div>
        </div>
      </div>
    `;
  });
}

function logout(){
  localStorage.removeItem("user");
  window.location.href="index.html";
}

</script>

</body>
</html>
